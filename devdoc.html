<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Developer documentation • sourmashconsumr</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Developer documentation"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">sourmashconsumr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="articles/sourmashconsumr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Developer documentation</h1>
      
    </div>

<div id="developer-documentation" class="section level1">

<p>The sourmashconsumr package follows package developer conventions laid out in <a href="https://r-pkgs.org/" class="external-link">https://r-pkgs.org/</a>. It uses this GitHub repository, the software for R and RStudio, and the R packages <code>devtools</code>, <code>testthat</code>, and <code>usethis</code> for development. The packages in the <code>DESCRIPTION</code> file are dependencies.</p>
<div class="section level2">
<h2 id="obtaining-the-sourmashconsumr-source-code-and-installing-package-and-development-dependencies">Obtaining the sourmashconsumr source code and installing package and development dependencies<a class="anchor" aria-label="anchor" href="#obtaining-the-sourmashconsumr-source-code-and-installing-package-and-development-dependencies"></a></h2>
<div class="section level3">
<h3 id="obtaining-the-source-code">Obtaining the source code<a class="anchor" aria-label="anchor" href="#obtaining-the-source-code"></a></h3>
<ul><li>Developers who are not members of the <a href="https://github.com/Arcadia-Science/" class="external-link">Arcadia-Science</a> organization: fork the repo to your own GitHub user account. Clone the repository locally.</li>
<li>Developers who are members of the <a href="https://github.com/Arcadia-Science/" class="external-link">Arcadia-Science</a> organization: clone the repository and create a branch. Clone the repository locally using <code>git clone</code>.</li>
</ul><p>See <a href="#contributing-changes-back-to-the-sourmashconsumr-repository">contributing section</a> below for instructions on how to contribute code changes back to the sourmashconsumr repository.</p>
</div>
<div class="section level3">
<h3 id="installing-r-and-rstudio">Installing R and RStudio<a class="anchor" aria-label="anchor" href="#installing-r-and-rstudio"></a></h3>
<p>Make sure you have R and RStudio installed (see <a href="https://rstudio-education.github.io/hopr/starting.html" class="external-link">here</a> for operating-system specific instructions).</p>
</div>
<div class="section level3">
<h3 id="opening-the-sourmashconsumr-r-project">Opening the sourmashconsumr R project<a class="anchor" aria-label="anchor" href="#opening-the-sourmashconsumr-r-project"></a></h3>
<p>You’ll then need to open the R project for the <code>sourmashconsumr</code> project. You can do this by double clicking the <code>sourmashconsumr.Rproj</code> file in your file finder or by using <code>File</code> -&gt; <code>Open Project...</code> and then finding and opening the <code>sourmashconsumr.Rproj</code> file.</p>
</div>
<div class="section level3">
<h3 id="installing-development-dependencies">Installing development dependencies<a class="anchor" aria-label="anchor" href="#installing-development-dependencies"></a></h3>
<p>To start developing the package, you’ll need to install <code>devtools</code>, <code>testthat</code>, and <code>usethis</code>.</p>
<p>You can use the following R command to install these packages:</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"testthat"</span>, <span class="st">"usethis"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>To be able to run all functions, and to run all of the tests, you will also need to install the package dependencies. See the instructions below for options for how to install these dependencies.</p>
</div>
<div class="section level3">
<h3 id="installing-the-package-dependencies">Installing the package dependencies<a class="anchor" aria-label="anchor" href="#installing-the-package-dependencies"></a></h3>
<p>The sourmashconsumr package has a lot of dependencies as it tries to make the outputs of the sourmash python package interoperable with biological computing packages already in the R ecosystem. You can install these dependencies however you like; they’re all documented in the <code>DESCRIPTION</code> file in the root of this repository. Below we describe different strategies for installing the dependencies.</p>
<div class="section level4">
<h4 id="installing-package-dependencies-using-r-functions">Installing package dependencies using R functions<a class="anchor" aria-label="anchor" href="#installing-package-dependencies-using-r-functions"></a></h4>
<p>Installing the sourmashconsumr package from GitHub will trigger missing dependencies to be installed.</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Arcadia-Science/sourmashconsumr"</span><span class="op">)</span></span></code></pre>
<p>Some of the package dependencies are available on Bioconductor (namely phyloseq), so if installation of dependencies fails through <code>install_github</code>, you may have more success using <code>BiocManager</code>:</p>
<pre><code><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.github.io/BiocManager/" class="external-link">"BiocManager"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"Arcadia-Science/sourmashconsumr"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="managing-the-development-environment-with-conda">Managing the development environment with conda<a class="anchor" aria-label="anchor" href="#managing-the-development-environment-with-conda"></a></h4>
<p>If the above methods fail, conda can be used to install the dependencies. You can find operating system-specific instructions for installing miniconda <a href="https://docs.conda.io/en/latest/miniconda.html" class="external-link">here</a>. Once you have conda and <a href="https://mamba.readthedocs.io/en/latest/" class="external-link">mamba</a> installed, you can create an environment with all of the sourmashconsumr dependencies and developer packages installed using the following bash command:</p>
<pre><code>mamba env create -n sourmashconsumr --file devenv.yml</code></pre>
<p>Then, activate the environment:</p>
<pre><code>conda activate sourmashconsumr</code></pre>
<p>You will still need to install RStudio after creating the conda environment. Then, if you’re using a Mac, you can open the sourmashconsumr Rproject by running <code>open sourmashconsumr.Rproj</code> from the activated environment you just created.</p>
<pre><code>open sourmashconsumr.Rproj</code></pre>
<p>On a Linux or Windows machine, running <code>rstudio</code> from the activated conda environment may open RStudio (untested).</p>
<pre><code><span><span class="va">rstudio</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="developing">Developing<a class="anchor" aria-label="anchor" href="#developing"></a></h2>
<p>sourmashconsumr is developed on GitHub at <a href="https://github.com/Arcadia-Science/sourmashconsumr/" class="external-link">Arcadia-Science/sourmashconsumr</a>. Changes can be contributed to sourmashconsumr via <a href="https://github.com/Arcadia-Science/sourmashconsumr/pulls" class="external-link">pull requests</a>.</p>
<div class="section level3">
<h3 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a></h3>
<p>To start developing, open the sourmashconsumr.Rproj in RStudio (see above). Then, load the <code>devtools</code> package and use the <code>devtools::load_all()</code> function to load sourmashconsumr.</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>You can then open the file you want to change and make changes.</p>
</div>
<div class="section level3">
<h3 id="adding-or-changing-functions">Adding or changing functions<a class="anchor" aria-label="anchor" href="#adding-or-changing-functions"></a></h3>
<p>Core package functions can be found in the <code>R</code> folder. Functions are grouped by action (e.g. <code>read_sourmash_outputs.R</code> contains all of the <code>read_*()</code> functions) or by data type (e.g. functions that involve plotting the output of sourmash taxonomy annotate are in the <code>plot_taxonomy_annotate.R</code> file).</p>
<div class="section level4">
<h4 id="naming-functions">Naming functions<a class="anchor" aria-label="anchor" href="#naming-functions"></a></h4>
<p>The functions in the sourmashconsumr package follow a naming scheme Functions that are exported (e.g. user-facing) are named by the action completed by the function, the sourmash output type the act on, and if relevant, a description of the action taken.</p>
<ul><li>
<strong>Action words</strong>:
<ul><li><code>read</code></li>
<li><code>plot</code></li>
<li><code>from</code></li>
</ul></li>
<li>
<strong>sourmash output types</strong>:
<ul><li><code>signature</code></li>
<li><code>compare_csv</code></li>
<li><code>gather</code></li>
<li><code>taxonomy_annotate</code></li>
</ul></li>
<li>
<strong>example actions</strong>:
<ul><li><code>to_metacoder</code></li>
<li><code>upset</code></li>
<li><code>heatmap</code></li>
<li><code>mds</code></li>
</ul></li>
</ul><p>Functions that are not exported do not follow a naming scheme but strive to be fully descriptive of their actions, and when possible use the <strong>sourmash output types</strong> to make it clear what type of data the internal function operates on.</p>
<ul><li>
<strong>examples of internal functions</strong>
<ul><li><code><a href="reference/check_compare_df_sample_col_and_move_to_rowname.html">check_compare_df_sample_col_and_move_to_rowname()</a></code></li>
<li><code><a href="reference/check_and_edit_names_in_signatures_df.html">check_and_edit_names_in_signatures_df()</a></code></li>
<li><code><a href="reference/check_uniform_parameters_in_signatures_df.html">check_uniform_parameters_in_signatures_df()</a></code></li>
<li><code><a href="reference/make_agglom_cols.html">make_agglom_cols()</a></code></li>
<li><code><a href="reference/make_expression.html">make_expression()</a></code></li>
<li><code><a href="reference/get_scaled_for_max_hash.html">get_scaled_for_max_hash()</a></code></li>
<li><code><a href="reference/pivot_wider_taxonomy_annotate.html">pivot_wider_taxonomy_annotate()</a></code></li>
</ul></li>
</ul></div>
<div class="section level4">
<h4 id="other-things">Other things<a class="anchor" aria-label="anchor" href="#other-things"></a></h4>
<p>For the <code>plot*</code> functions, sourmashconsumr tries not to put anything in the <code>theme()</code> layer so that users can control the look of their plot with out conflicts. This isn’t always do-able, but we strive to follow this rule.</p>
<p>Layers that label the plot should be controlled to by a boolean argument <code>label</code> so that users can turn off labels and re-add them themselves so they can control the look of those labels (italicized, size, etc.). When there is a label boolean as a function argument, the <code>@param</code> string documenting that parameter should contain an example of how to add the default labels back to the plot as some of these are esoteric and would be hard to divine without an example.</p>
</div>
</div>
<div class="section level3">
<h3 id="tests">Tests<a class="anchor" aria-label="anchor" href="#tests"></a></h3>
<p>The sourmashconsumr package uses unit tests to make sure that code changes don’t break existing functions. Tests and test files are located in the <code>tests/testthat</code> folder. To run all tests, you can use the <code>testthat::test()</code> function:</p>
<pre><code><span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>Alternatively, you can run tests related to the active file:</p>
<pre><code><span><span class="fu">test_active_file</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<p>Documentation is coordinated by roxygen and the <code>devtools::document()</code> function. The documentation for each function is contained in roxygen blocks (<code>#'</code>) above the function. These blocks are automatically parsed by the <code>document()</code> function to produce the files in the <code>man/*</code> directory. Therefore, the files in the <code>man/*</code> directory should not be manually edited.</p>
<p>The only exception to this is the packages listed in the DESCRIPTION file. These packages are added to the DESCRIPTION file using the <code>usethis::use_package()</code> function.</p>
</div>
<div class="section level3">
<h3 id="vignette">Vignette<a class="anchor" aria-label="anchor" href="#vignette"></a></h3>
<p>The vignette html file is built from the Rmd file <code>vignettes/sourmashconsumr.Rmd</code>. The vignette can be built using the following command:</p>
<pre><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_rmd</span><span class="op">(</span><span class="st">"vignettes/sourmashconsumr.Rmd"</span><span class="op">)</span></span></code></pre>
<p>If you make changes to the vignette, make sure you build it locally and that your changes appear how you want them to before you push changes to GitHub. The html file should not be pushed to GitHub.</p>
</div>
<div class="section level3">
<h3 id="github-readme">GitHub README<a class="anchor" aria-label="anchor" href="#github-readme"></a></h3>
<p>The README.md is created from a README.Rmd file. To edit the README.md file, make changes to the README.Rmd file and knit it.</p>
</div>
<div class="section level3">
<h3 id="pkgdown-package-documentation-site">pkgdown package documentation site<a class="anchor" aria-label="anchor" href="#pkgdown-package-documentation-site"></a></h3>
<p>sourmashconsumr uses <a href="https://pkgdown.r-lib.org/index.html" class="external-link">pkgdown</a> to build the sourmashconsumr documentation. To build the package documentation site locally, you can use:</p>
<pre><code><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_pkgdown</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>You shouldn’t have to do this next part, but to set up GitHub Actions so the site would be automatically built, we used the following code:</p>
<pre><code><span><span class="co"># set up git credentials</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">gh_token_help</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">create_github_token</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">gitcreds</span><span class="fu">::</span><span class="fu">gitcreds_set</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># use gh-pages and github actions to build site</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_pkgdown_github_pages</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="checking-all-the-things">Checking all the things<a class="anchor" aria-label="anchor" href="#checking-all-the-things"></a></h3>
<p>After making changes, you should run <code>devtools::check()</code> locally to make sure all tests pass, documentation is updated, and there are no other failures or warning in the local build process.</p>
<pre><code><span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="contributing-changes-back-to-the-sourmashconsumr-repository">Contributing changes back to the sourmashconsumr repository<a class="anchor" aria-label="anchor" href="#contributing-changes-back-to-the-sourmashconsumr-repository"></a></h2>
<p>Contributions can be made to the sourmashconsumr package using <a href="https://github.com/Arcadia-Science/sourmashconsumr/pulls" class="external-link">pull requests</a>. While not required, you may want to open an <a href="https://github.com/Arcadia-Science/sourmashconsumr/issues" class="external-link">issue</a> first to discuss your proposed changes. Pull requests should be opened against the <code>main</code> branch. When you open a pull request from your branch or fork, GitHub Actions will automatically launch continuous integration checks to make sure that the proposed changes pass R-CMD check across different operating systems (Mac, Windows, Linux). All checks must pass for new code to be merged into the <code>main</code> branch. The CI actions will also calculate changes to code coverage, or how much of the code base is covered by tests. All exported functions should have a corresponding test.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Taylor Reiter.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

